<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>STILL VØID | Index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <script>
        // ОТКЛЮЧАЕМ АВТО-СКРОЛЛ БРАУЗЕРА (мы делаем это сами точнее)
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        if (sessionStorage.getItem('isReturning') === 'true') {
            document.documentElement.classList.add('returning-visitor');
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500&family=Syncopate:wght@400;700&display=swap');

        :root { --bg: #050505; --text: #e1e1e1; --dim: #888; --accent: #fff; }
        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Manrope', sans-serif;
            height: 100dvh; width: 100vw;
            overflow: hidden; 
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
            cursor: default; user-select: none;
        }

        a, button { text-decoration: none; color: inherit; cursor: pointer; border: none; background: none; font-family: inherit; padding: 0; outline: none; }

        /* VIGNETTE */
        .vignette-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 25%, rgba(0,0,0,0) 75%, rgba(0,0,0,0.6) 100%);
        }

        /* --- PRELOADER --- */
        .preloader { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg); z-index: 9999; 
            display: flex; align-items: center; justify-content: center;
            transition: transform 1.2s cubic-bezier(0.8, 0, 0.1, 1), opacity 0.5s ease 0.7s; 
            will-change: transform; 
        }
        .preloader.hide { transform: translateY(-100%); pointer-events: none; }

        .progress-bar { width: 180px; height: 1px; background: rgba(255,255,255,0.15); position: relative; overflow: hidden; }
        .progress-fill { 
            position: absolute; top: 0; left: 0; height: 100%; width: 0%; 
            background: #fff; 
            transition: width 0.4s cubic-bezier(0.2, 0, 0.2, 1); 
            will-change: width;
        }

        html.returning-visitor .preloader { display: none !important; }

        /* --- CURTAIN --- */
        .curtain { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 9990; 
            transform: translateY(105%); 
            transition: transform 1.3s cubic-bezier(0.75, 0, 0.1, 1);
            pointer-events: none;
            will-change: transform;
            backface-visibility: hidden;
        }
        .curtain.active { transform: translateY(0%); }
        html.returning-visitor .curtain { transform: translateY(0%); }
        html.returning-visitor .curtain.lift-up { transform: translateY(-100%); }

        /* --- UI --- */
        .frame-ui { position: fixed; left: 20px; right: 20px; z-index: 100; opacity: 0; transition: opacity 1s ease 1s; pointer-events: none; }
        .frame-ui.visible { opacity: 1; pointer-events: auto; }
        html.returning-visitor .frame-ui { transition: opacity 0.8s ease 0.2s !important; }

        /* Align center сохранено для бренда */
        .frame-top { top: 20px; display: flex; justify-content: space-between; align-items: center; }
        .frame-bottom { bottom: 20px; display: flex; justify-content: space-between; align-items: flex-end; }
        .interactive { pointer-events: auto; }
        
        .brand-name { font-family: 'Syncopate'; font-weight: 700; font-size: 14px; letter-spacing: 0.05em; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .menu { display: flex; gap: 20px; font-size: 12px; text-transform: uppercase; font-weight: 600; letter-spacing: 0.05em; }
        .info-btn { 
            position: relative; opacity: 1; border: 1px solid rgba(255,255,255,0.4); 
            padding: 5px 12px; border-radius: 20px; transition: all 0.3s ease; 
            background: rgba(0,0,0,0.2); backdrop-filter: blur(4px); color: #fff;
        }
        .info-btn:hover, .info-btn.active { background: #fff; color: #000; border-color: #fff; }

        /* --- INFO OVERLAY --- */
        .info-overlay { 
            position: fixed; top: 0; right: 0; width: 500px; max-width: 100%; height: 100%; 
            background: #0f0f0f; z-index: 500; 
            transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); 
            padding: 60px; display: flex; flex-direction: column; justify-content: center;
            border-left: 1px solid rgba(255,255,255,0.08);
        }
        .info-overlay.open { transform: translateX(0); }
        .info-close { position: absolute; top: 30px; right: 30px; font-size: 24px; padding: 10px; opacity: 0.5; transition: 0.3s; cursor: pointer;}
        .info-close:hover { opacity: 1; }
        
        .profile-pic { width: 80px; height: 100px; object-fit: cover; margin-bottom: 30px; filter: grayscale(100%); border-radius: 2px; }
        .info-block { margin-bottom: 40px; }
        .info-label { font-family: 'Syncopate'; font-size: 10px; color: var(--dim); margin-bottom: 15px; letter-spacing: 0.1em; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 5px; display: inline-block;}
        .info-text { font-size: 15px; line-height: 1.6; color: #ccc; font-weight: 300; max-width: 380px; }
        .info-list { display: flex; flex-direction: column; gap: 8px; }
        .info-link { font-size: 16px; font-weight: 300; color: #fff; opacity: 0.7; transition: opacity 0.2s; display: inline-block; }
        .info-link:hover { opacity: 1; }
        .socials-row { display: flex; gap: 20px; margin-top: 15px; }

        /* --- LIST & SCROLL --- */
        .scroll-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; overflow-x: hidden; z-index: 10;
            scroll-behavior: auto; scroll-snap-type: y mandatory;
            scrollbar-width: none; -ms-overflow-style: none;
            transition: transform 1.2s cubic-bezier(0.7, 0, 0.1, 1), opacity 0.8s ease;
            will-change: transform, opacity; 
            transform-origin: center center;
        }
        .scroll-container.smooth { scroll-behavior: smooth; }
        .scroll-container.exiting { transform: scale(0.93); opacity: 0; filter: blur(5px); }
        html.returning-visitor .scroll-container { transition-delay: 0s !important; }

        .scroll-container::-webkit-scrollbar { display: none; }

        .project-list {
            list-style: none; padding: 0; margin: 0; width: 100%;
            padding-top: 45vh; padding-bottom: 45vh;
            display: flex; flex-direction: column; align-items: center;
            /* По умолчанию мышь отключена */
            pointer-events: none; 
        }
        /* Включается классом */
        .project-list.interactive-ready { pointer-events: auto; }

        .project-item {
            margin: 0; width: 100%; height: 25vh;
            display: flex; align-items: center; justify-content: center;
            scroll-snap-align: center; position: relative;
        }

        .project-link {
            width: fit-content; margin: 0 auto; display: flex; align-items: center; gap: 20px;
            text-align: center; font-size: clamp(2rem, 9vw, 6rem);
            line-height: 1; font-weight: 300; text-transform: uppercase; letter-spacing: -0.03em;
            color: rgba(255,255,255,0.25); padding: 10px 20px; 
            transition: all 0.5s ease; will-change: transform, opacity;
            opacity: 0; transform: translateY(100%);
            text-shadow: 0 10px 40px rgba(0,0,0,0.8);
            cursor: pointer;
        }
        
        .link-arrow {
            display: block; font-size: 0.5em; font-weight: 300; opacity: 0;
            transform: translate(-20px, 20px); transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            color: var(--accent); position: relative; top: 0.05em; 
        }

        .project-link.revealed { opacity: 0.4; transform: translateY(0); filter: blur(0px); }
        .project-link.revealed-instant { opacity: 0.4; transform: translateY(0); filter: blur(0px); transition: none; }

        html.returning-visitor .project-link {
            opacity: 0.4 !important;
            transform: translateY(0) !important;
            transition: none !important;
        }
        html.returning-visitor .project-link.active {
            opacity: 1 !important;
            color: #fff !important;
        }

        html.returning-visitor .frame-ui {
            opacity: 1 !important;
            transition: none !important;
        }

        /* Desktop Hover */
        .project-link:hover, .project-link.active { 
            opacity: 1 !important; color: #fff !important; 
            transform: translateX(15px) !important; 
        }
        .project-link:hover .link-arrow, .project-link.active .link-arrow { opacity: 1; transform: translate(0, 0); }
        .project-list.focus-mode .project-link:not(:hover) { opacity: 0.15; filter: blur(3px); transform: translateX(0); }

        /* --- STACK SYSTEM --- */
        .bg-stack { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 1; pointer-events: none; background: #050505;
            transform: translateZ(0); 
        }
        
        #revealBox {
            position: fixed; width: 340px; height: 460px; pointer-events: none; z-index: 20; top: 0; left: 0;
            transform: translate(-50%, -50%); overflow: hidden; will-change: transform;
        }

        .stack-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; 
            opacity: 0; 
            transform: scale(1.15);
            transition: opacity 0.6s ease, transform 0.8s ease;
            will-change: opacity, transform;
            backface-visibility: hidden;
        }
        
        .stack-image.active { 
            opacity: 1; 
            transform: scale(1);
            z-index: 2;
        }

        @media (min-width: 769px) {
            .scroll-container { overflow: hidden; padding: 0; display: flex; align-items: center; justify-content: center; }
            .project-list { padding: 0; height: auto; gap: 1vh; }
            .project-item { height: auto; scroll-snap-align: none; }
            .bg-stack { display: none; } 
            .vignette-overlay { display: none; }
        }
        
        @media (max-width: 768px) {
            #revealBox { display: none !important; }
            .project-item { height: 30vh; }
            .info-overlay { padding: 60px 30px; }
            .project-link { width: 100%; justify-content: center; } 
            .project-link:hover, .project-link.active { transform: none !important; }
            .bg-stack .stack-image.active { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="preloader" id="preloader">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>
    
    <div class="curtain" id="pageCurtain"></div>
    <div class="vignette-overlay"></div>

    <div class="info-overlay" id="infoPanel">
        <button class="info-close interactive" onclick="toggleInfo()">×</button>
        <img src="444.png" class="profile-pic" alt="Profile">
        <div class="info-block"><div class="info-label">Bio</div><div class="info-text">Visual artist based in Berlin. Focusing on the space between architecture and human emotion.</div></div>
        <div class="info-block"><div class="info-label">Contact</div><div class="info-list"><a href="mailto:studio@stillvoid.raw" class="info-link interactive">studio@stillvoid.raw</a></div><div class="socials-row"><a href="https://instagram.com/jump.into.abyss" class="info-link small interactive">Instagram</a><a href="https://x.com/jumpinabyss" class="info-link small interactive">X.com</a></div></div>
        <div class="frame-ui frame-bottom" style="position: absolute; left: 30px; right: 30px; mix-blend-mode: normal;"><div style="font-size: 10px; opacity: 0.3; text-transform: uppercase;">Studio STILL VØID / 2026</div></div>
    </div>

    <div class="bg-stack" id="bgStack"></div>
    <div id="revealBox"></div>

    <div class="frame-ui frame-top">
        <div class="brand-name interactive">STILL VØID</div>
        <nav class="menu interactive"><button class="info-btn" id="infoBtn" onclick="toggleInfo()">Profile</button></nav>
    </div>

    <div class="scroll-container" id="scrollContainer">
        <ul class="project-list" id="projectList"></ul>
    </div>

    <div class="frame-ui frame-bottom">
        <div style="font-size: 10px; opacity: 0.5;">© 2026</div>
    </div>

    <script src="config.js"></script>

<script>
    if (typeof SITE_CONFIG === 'undefined') {
        alert("Config Error!");
    } else {
        const projectList = document.getElementById('projectList');
        const bgStack = document.getElementById('bgStack');
        const revealBox = document.getElementById('revealBox');
        const scrollContainer = document.getElementById('scrollContainer');
        const preloader = document.getElementById('preloader');
        
        const isReturning = sessionStorage.getItem('isReturning') === 'true';
        // --- FIX: Читаем сохраненный индекс, а не скролл ---
        const savedIndex = parseInt(sessionStorage.getItem('lastActiveIndex') || '0');
        const isMobile = window.matchMedia("(max-width: 768px)").matches;

        let imagesLoaded = 0;
        let isInteractionAllowed = false; 

        // --- LERP (DESKTOP) ---
        const mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        const boxPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        const speed = 0.08; 
        
        if (!isMobile) {
            window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
            function renderLoop() {
                boxPos.x += (mouse.x - boxPos.x) * speed;
                boxPos.y += (mouse.y - boxPos.y) * speed;
                const rx = Math.round(boxPos.x * 10) / 10;
                const ry = Math.round(boxPos.y * 10) / 10;
                revealBox.style.transform = `translate(${rx}px, ${ry}px) translate(-50%, -50%)`;
                requestAnimationFrame(renderLoop);
            }
            renderLoop();
        }

        // --- BUILDER ---
        const loadPromises = [];

        SITE_CONFIG.forEach((proj, index) => {
            const previewSrc = `images/${proj.folder}/01.jpg`;
            const pngSrc = `images/${proj.folder}/01.png`;
            
            const li = document.createElement('li');
            li.className = 'project-item';
            li.innerHTML = `<div data-href="project.html?id=${proj.folder}" class="project-link interactive" id="link-${index}" onclick="handleNav(event, ${index})">${proj.title} <span class="link-arrow">↗</span></div>`;
            projectList.appendChild(li);

            function createImg(container, id) {
                const img = document.createElement('img');
                img.className = 'stack-image';
                img.id = id;
                img.decoding = "async"; 
                container.appendChild(img);
                return img;
            }

            const mobImg = createImg(bgStack, `bg-${index}`);
            let deskImg = null;
            if (!isMobile) {
                deskImg = createImg(revealBox, `cursor-${index}`);
            }

            const p = new Promise((resolve) => {
                const img = new Image();
                img.src = previewSrc;
                img.onload = () => {
                    if(mobImg) mobImg.src = previewSrc;
                    if(deskImg) deskImg.src = previewSrc;
                    
                    const decodePromises = [];
                    if(mobImg) decodePromises.push(mobImg.decode());
                    if(deskImg) decodePromises.push(deskImg.decode());

                    Promise.all(decodePromises).then(() => resolve()).catch(() => resolve());
                };
                img.onerror = () => {
                    if(mobImg) mobImg.src = pngSrc;
                    if(deskImg) deskImg.src = pngSrc;
                    resolve();
                };
            });
            
            loadPromises.push(p);
        });

        // --- PROGRESS ---
        let fakeProgress = 0;
        let isAssetsReady = false;
        
        function updateProgress() {
            const target = isAssetsReady ? 100 : 90;
            fakeProgress += (target - fakeProgress) * 0.05;
            document.getElementById('progressFill').style.width = fakeProgress + "%";
            
            if (fakeProgress >= 99.5 && isAssetsReady) {
                document.getElementById('progressFill').style.width = "100%";
                startSite();
            } else {
                requestAnimationFrame(updateProgress);
            }
        }
        
        if (!isReturning) {
            requestAnimationFrame(updateProgress);
        }

        Promise.all(loadPromises).then(() => {
            onAllAssetsReady();
        });

        function onAllAssetsReady() {
            isAssetsReady = true;
            const allImgs = document.querySelectorAll('.stack-image');
            allImgs.forEach(img => { img.style.opacity = '0.005'; });
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    allImgs.forEach(img => img.style.opacity = '');
                    if (isReturning) startSite();
                });
            });
        }

        function startSite() {
            if (isReturning) {
                setTimeout(() => { isInteractionAllowed = true; }, 50);

                if (isMobile) {
                    // --- FIX: SCROLL TO INDEX ---
                    // Активируем нужный слайд
                    activateSlide(savedIndex);
                    const activeLink = document.getElementById(`link-${savedIndex}`);
                    if(activeLink) activeLink.classList.add('active');

                    // Скроллим к нему принудительно
                    const targetItem = projectList.children[savedIndex];
                    if(targetItem) {
                        targetItem.scrollIntoView({ block: 'center', behavior: 'instant' });
                    }
                }

                document.querySelectorAll('.project-link').forEach(link => link.classList.add('revealed-instant'));
                document.querySelectorAll('.frame-ui').forEach(el => el.classList.add('visible'));
                projectList.classList.add('interactive-ready');

                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        document.querySelector('.curtain').classList.add('lift-up');
                    });
                });

                sessionStorage.removeItem('isReturning');
                setTimeout(() => scrollContainer.classList.add('smooth'), 100);

            } else {
                // INTRO
                isInteractionAllowed = false;

                setTimeout(() => { 
                    requestAnimationFrame(() => {
                        document.getElementById('preloader').classList.add('hide'); 
                    });
                }, 300);
                
                setTimeout(() => {
                    document.querySelectorAll('.frame-ui').forEach(el => el.classList.add('visible'));
                    const links = document.querySelectorAll('.project-link');
                    
                    links.forEach((link, idx) => {
                        setTimeout(() => { 
                            link.classList.add('revealed'); 
                            if (!isMobile) {
                                link.addEventListener('mouseenter', () => {
                                    if(!isInteractionAllowed) return; 
                                    projectList.classList.add('focus-mode');
                                });
                                link.addEventListener('mouseleave', () => {
                                    if(!isInteractionAllowed) return; 
                                    projectList.classList.remove('focus-mode');
                                });
                            }
                        }, idx * 100);
                    });

                    // INSTANT UNLOCK WITH CURTAIN
                    setTimeout(() => {
                        isInteractionAllowed = true;
                        projectList.classList.add('interactive-ready');
                        
                        if (!isMobile) {
                            const hoveredEl = document.elementFromPoint(mouse.x, mouse.y);
                            if (hoveredEl) {
                                const link = hoveredEl.closest('.project-link');
                                if (link) {
                                    const index = link.id.split('-')[1];
                                    activateSlide(index);
                                    projectList.classList.add('focus-mode');
                                }
                            }
                        }
                        
                        if (isMobile) {
                            activateSlide(0);
                            const first = document.getElementById('link-0');
                            if(first) first.classList.add('active');
                        }
                        scrollContainer.classList.add('smooth');
                    }, 1200); 

                }, 400); 
            }
        }

        function activateSlide(index) {
            document.querySelectorAll('.bg-stack .stack-image').forEach(el => el.classList.remove('active'));
            if (!isMobile) {
                document.querySelectorAll('#revealBox .stack-image').forEach(el => el.classList.remove('active'));
            }
            
            const mobBg = document.getElementById(`bg-${index}`);
            if(mobBg) mobBg.classList.add('active');

            if (!isMobile) {
                const deskBg = document.getElementById(`cursor-${index}`);
                if(deskBg) deskBg.classList.add('active');
            }
        }

        const observerOptions = {
            root: null,
            rootMargin: '-50% 0px -50% 0px', 
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const link = entry.target.querySelector('.project-link');
                    if (link && (link.classList.contains('revealed') || link.classList.contains('revealed-instant'))) {
                        const index = link.id.split('-')[1];
                        document.querySelectorAll('.project-link').forEach(el => el.classList.remove('active'));
                        link.classList.add('active');
                        activateSlide(index);
                    }
                }
            });
        }, observerOptions);

        if (isMobile) {
            document.querySelectorAll('.project-item').forEach(item => observer.observe(item));
        } else {
            projectList.addEventListener('mouseover', (e) => {
                if (!isInteractionAllowed) return; 
                const link = e.target.closest('.project-link');
                if (link) {
                    const index = link.id.split('-')[1];
                    activateSlide(index);
                }
            });
            projectList.addEventListener('mouseout', (e) => {
                if (!isInteractionAllowed) return; 
                const link = e.target.closest('.project-link');
                if (link) {
                    document.querySelectorAll('#revealBox .stack-image').forEach(el => el.classList.remove('active'));
                }
            });
        }

        window.handleNav = function(e, index) {
            e.preventDefault();
            const url = e.currentTarget.getAttribute('data-href');
            
            // --- FIX: SAVE INDEX ---
            sessionStorage.setItem('lastActiveIndex', index);
            
            sessionStorage.setItem('isReturning', 'true');
            const c = document.getElementById('pageCurtain');
            c.classList.remove('lift-up'); c.classList.add('active');
            document.getElementById('scrollContainer').classList.add('exiting');
            setTimeout(() => { window.location.href = url; }, 900);
        }

        window.toggleInfo = function() {
            const panel = document.getElementById('infoPanel');
            const btn = document.getElementById('infoBtn');
            panel.classList.toggle('open');
            btn.classList.toggle('active');
        }
    }
</script>
</body>
</html>